# 台灣資本交易所（TCEX）專案簡介

> 本文件為 TCEX 專案的整體介紹，供非技術背景的經營團隊參考。

---

## 一、我們要做什麼？

**TCEX（Taiwan Capital Exchange，台灣資本交易所）** 是一個專為台灣中小企業設計的金融資產交易平台，核心業務是「收入分成」模式——讓投資人可以購買中小企業未來收入的一部分，企業則藉此獲得融資。

簡單來說：
- **對企業**：不用借貸、不用稀釋股權，就能取得營運資金
- **對投資人**：用較低門檻參與企業成長，獲得收入分成回報

我們參考了澳門的 MCEX（澳門資本交易所）的業務模式，但完全針對台灣市場重新設計了使用者體驗、合規架構和技術系統。

---

## 二、平台提供哪些金融產品？

| 產品類型 | 說明 |
|---------|------|
| **RBO（收入基礎債務）** | 投資人購買企業未來收入的分成權利，依據實際營收定期獲得回報 |
| **SPV（特殊目的機構）** | 將多個底層資產打包成一個投資標的，分散風險 |
| **SPAC（特殊目的收購公司）** | 先募資、後併購的投資工具 |
| **ETF（交易所買賣基金）** | 追蹤特定指數或資產組合的基金產品 |

---

## 三、平台的主要功能

### 給投資人的功能
| 功能 | 說明 |
|------|------|
| 即時市場數據 | 隨時查看交易量、融資金額、收入分成金額等關鍵指標 |
| 線上交易 | 在平台上直接買賣金融產品（市價單、限價單、停損單） |
| 投資組合管理 | 查看持有部位、損益、資產配置 |
| 收入分成發放 | 自動計算並發放收入分成至投資人帳戶 |
| 錢包管理 | 新台幣入金、出金、餘額查詢 |
| 自選清單 | 追蹤感興趣的標的，設定價格提醒 |
| 通知系統 | 透過 LINE、Email 接收交易、分成、帳戶安全通知 |

### 給企業（掛牌方）的功能
| 功能 | 說明 |
|------|------|
| 掛牌申請 | 線上提交掛牌資料 |
| 融資管理 | 追蹤融資進度和狀態 |
| 收入分成管理 | 查看分成計算和發放記錄 |
| 業績報告 | 定期上傳營運數據 |

### 給管理團隊的功能
| 功能 | 說明 |
|------|------|
| 後台總覽儀表板 | 即時顯示總用戶數、待審 KYC 數量、總交易筆數、活躍委託單數 ✅ |
| KYC L2 審核介面 | 展開式申請卡片，含個人資料、文件數量；支援核准/拒絕並附審核備注 ✅ |
| 用戶管理介面 | 可搜尋用戶清單，顯示 Email、KYC 等級、Email/手機驗證狀態；支援凍結/解凍帳號 ✅ |
| 稽核軌跡 | KYC 審核與帳號狀態變更均自動寫入不可竄改的 audit_log ✅ |
| 市場控制 | 緊急暫停交易、熔斷機制管理 |
| 合規報表 | 自動產生金管會要求的各類報表 |

---

## 四、與澳門 MCEX 的差異

| 項目 | MCEX（澳門） | TCEX（台灣） |
|------|-------------|-------------|
| 所在地 | 澳門特別行政區 | 台灣 |
| 使用貨幣 | 澳門幣（MOP） | 新台幣（TWD） |
| 監管機構 | 澳門金融管理局（AMCM） | 台灣金融監督管理委員會（金管會） |
| 社群平台 | 微信（WeChat） | LINE |
| 身份驗證 | 澳門身份證 | 台灣身分證 + 自然人憑證 |
| 使用者體驗 | 舊式設計 | 全新現代化設計，符合無障礙標準 |
| 語言 | 繁體中文 / 英文 | 繁體中文 / 英文（相同） |

**重點：我們不是照抄 MCEX，而是以它的業務模式為參考，從零開始設計適合台灣市場的全新平台。**

---

## 五、使用者如何使用平台？

### 投資人的使用流程

```
1. 註冊帳號（Email）
      ↓
2. 驗證手機號碼
      ↓
3. 身份驗證（上傳身分證 + 自拍照）
      ↓
4. 等待審核（1-3個工作天）
      ↓
5. 入金（銀行轉帳至 TCEX 指定帳戶）
      ↓
6. 開始交易（瀏覽產品 → 下單 → 輸入雙重驗證碼）
      ↓
7. 收取收入分成（自動發放至錢包）
      ↓
8. 出金（提領新台幣至個人銀行帳戶）
```

### 身份驗證（KYC）分級制度

| 等級 | 需要提供 | 可以做什麼 |
|------|---------|-----------|
| 等級 0 | 僅 Email 驗證 | 瀏覽市場資料、建立自選清單 |
| 等級 1 | 手機驗證 + 基本資料 | 查看投資組合、接收分成 |
| 等級 2 | 身分證 + 地址證明 | 交易（每月上限50萬新台幣） |
| 等級 3 | 加強盡職調查 | 無限制交易、機構級功能 |

---

## 六、網站長什麼樣？

### 公開網站（所有人可見）

**首頁設計原則：以信任為核心**

首頁從上到下依序呈現：

1. **主視覺區** — 平台名稱、使命宣言、「開始交易」按鈕、金管會許可字號
2. **即時市場數據** — 四大指標卡片：當日交易量、累計融資金額、活躍掛牌數、當日收入分成
3. **產品亮點** — RBO、SPV、SPAC 三張產品介紹卡片
4. **信任與公信力** — 金管會監管標示、合作夥伴 LOGO（銀行、審計、託管）、安全認證
5. **市場地圖** — 互動式世界地圖，展示底層資產的地理分布
6. **最新公告** — 最新的市場通訊和公告

### 網站導覽結構（簡化為五大區塊）

| 區塊 | 包含頁面 |
|------|---------|
| 市場 | 總覽、產品介紹、掛牌資訊、交易日曆、交易時間、費用 |
| 服務 | 登記託管、清算結算、業績參數、信用評級、跨境通道、估值方法、稅務處理 |
| 資源 | 規則監管、市場通訊、市場支持、檔案下載 |
| 關於 | 關於 TCEX、創始人網誌、媒體中心、招聘、CSR、財務報告、聯絡我們 |
| 搜尋 | 全站搜尋功能 |

### 會員專區（登入後可見）

| 頁面 | 功能 |
|------|------|
| 總覽儀表板 | 投資組合價值、損益、待處理訂單、最近活動 |
| 投資組合 | 持有部位明細、資產配置圖、績效走勢圖 |
| 交易頁面 | 即時報價圖表、買賣委託單、掛單簿 |
| 訂單管理 | 進行中訂單、歷史訂單、篩選匯出 |
| 錢包 | 餘額查詢、入金、出金、交易紀錄 |
| 收入分成 | 即將發放、歷史紀錄、年度稅務摘要 |
| 自選清單 | 追蹤標的、價格提醒 |
| 通知中心 | 交易通知、分成通知、系統公告 |
| 設定 | 個人資料、安全設定、KYC、通知偏好 |

---

## 七、系統架構概覽

整個系統建立在 **Cloudflare 雲端平台** 上，統一管理，不需要自己維護伺服器：

```
┌──────────────────────────────────────────────────────────────┐
│                    Cloudflare 雲端平台                          │
│                                                              │
│   ┌──────────────┐   服務綁定    ┌──────────────┐            │
│   │  公開網站     │ ───────────▶ │  交易核心     │            │
│   │  (Portal)    │              │  (Engine)    │            │
│   │              │  ◀─WebSocket─ │              │            │
│   │ • 首頁       │              │ • 撮合引擎    │            │
│   │ • 會員專區   │              │  （每檔獨立）  │            │
│   │ • API 路由   │              │ • 即時推送    │            │
│   │ • 多語系     │              │ • 掛單簿狀態  │            │
│   │ • 身份驗證   │              │ • 風險控管    │            │
│   └──────────────┘              └──────────────┘            │
│                                                              │
│   ┌────────────────────────────────────────────────────┐    │
│   │  資料儲存：D1 資料庫 · KV 快取 · R2 檔案 · 事件佇列  │    │
│   └────────────────────────────────────────────────────┘    │
│                                                              │
│   兩個獨立部署單元，透過服務綁定通訊                             │
└──────────────────────────────────────────────────────────────┘
```

### 各模組說明

| 模組 | 用途 | 白話說明 |
|------|------|---------|
| 公開網站 + API（Portal） | 展示平台資訊、會員專區、處理資料請求、驗證身份 | 官方網站，用戶看到的所有畫面都在這裡 |
| 交易核心（Engine） | 撮合買賣、即時推送（WebSocket）、管理掛單簿 | 平台的心臟，每個掛牌產品有獨立的撮合引擎 |
| 資料儲存 | 資料庫、快取、檔案、事件紀錄 | 平台的記憶體，安全保存所有紀錄 |

> **為什麼選擇 Cloudflare？** 不需要自己管理伺服器，費用極低（MVP 階段幾乎免費），全球部署速度快，台灣用戶體驗佳。撮合引擎使用 Durable Objects 技術——每個掛牌產品有獨立的運算單元，天然隔離、不會互相影響，且自動處理 WebSocket 連線管理。若未來金管會要求資料必須存放在台灣境內機房，可無縫遷移至 GCP 台灣機房，不需要改寫程式碼。

---

## 八、法規遵循

這是金融平台最重要的一環。我們的設計完全考量台灣法規要求：

### 監管架構

| 項目 | 說明 |
|------|------|
| 主管機關 | 金融監督管理委員會（金管會） |
| 適用法規 | 證券交易法、期貨交易法、洗錢防制法、個資法等7部法律 |
| 監理沙盒 | 可考慮先申請金融科技創新實驗（最長18個月，可延長12個月） |

### 洗錢防制（AML）

| 措施 | 說明 |
|------|------|
| 客戶盡職調查 | 依 KYC 等級進行不同程度的身份查核 |
| 交易監控 | 自動偵測可疑交易模式（例：單筆超過50萬、短時間大額進出） |
| 制裁名單篩查 | 比對台灣法務部、聯合國、OFAC、歐盟等制裁名單 |
| 可疑交易申報 | 發現可疑交易後2個工作天內向法務部調查局申報 |
| PEP 監控 | 針對政治敏感人物進行加強監控 |

### 資料保護

| 項目 | 做法 |
|------|------|
| 資料存放 | MVP 階段使用 Cloudflare 亞太區機房；正式營運後可遷移至台灣境內（GCP 台灣機房） |
| 加密 | 所有資料傳輸和儲存均採用銀行級加密（AES-256, TLS 1.3） |
| 稽核軌跡 | 所有交易行為產生不可竄改的紀錄，保存10年 |
| 個資權利 | 用戶可查詢、更正、刪除個人資料（符合個資法） |
| 資安事件 | 資料外洩須於72小時內通報金管會及受影響用戶 |

### 定期報表

| 報表 | 頻率 | 備註 |
|------|------|------|
| 每日交易摘要 | 每日（T+1） | 西曆格式 |
| 月營運報告 | 每月 | 民國紀年 |
| 季度財務報告 | 每季 | 經會計師查核 |
| 年度合規報告 | 每年 | 綜合性報告 |
| 洗錢防制統計 | 每季 | 向金管會申報 |

### 投資人保護

- 首次交易前必須簽署 **投資風險聲明書**
- 填寫 **風險承受度問卷**，系統會根據結果限制不適合的產品
- 設置客訴專線，1個工作天內回覆，15個工作天內處理完畢
- 30天未解決可向金管會申訴

---

## 九、安全機制

| 機制 | 說明 |
|------|------|
| 雙重驗證（2FA） | 所有交易和出金必須輸入驗證碼（Google Authenticator 或簡訊） |
| Google 登入 | 支援 Google 帳號快速登入／註冊（Email 自動驗證，免填表單） |
| LINE 登入 | 支援 LINE 帳號快速登入 |
| 帳戶鎖定 | 連續5次密碼錯誤，帳戶自動鎖定15分鐘 |
| 異常偵測 | 從新地點登入時需透過 Email 確認 |
| 裝置管理 | 最多同時3個裝置登入 |
| 熔斷機制 | 單一產品漲跌幅超過±10%自動暫停交易 |
| 全市場暫停 | 超過20%產品觸發熔斷時，全市場暫停交易 |

---

## 十、開發計畫（一人開發 + CEO）

### 第一階段：公開網站 ✅ 已完成

| 步驟 | 內容 | 交付成果 |
|------|------|---------|
| 1.1 | 建立 SvelteKit 專案 + Tailwind 樣式 | 開發環境就緒 |
| 1.2 | 設定雙語系統（繁中/英文）+ 中文字體 | 雙語網站架構 |
| 1.3 | 製作共用元件：導覽列、頁尾、手機選單 | 全站導覽可用 |
| 1.4 | 製作首頁：主視覺、市場數據、產品卡片、信任標章 | 對外展示的第一印象 |
| 1.5 | 製作靜態頁面：關於、聯絡、產品介紹、規則 | 完整的資訊內容 |
| 1.6 | 部署到 Cloudflare | **正式網址，可分享給合作夥伴與投資人** |

### 第二階段：用戶系統 ✅ 已完成

| 步驟 | 內容 | 交付成果 |
|------|------|---------|
| 2.1 | 建立 D1 資料庫 + 用戶資料表 | 資料庫基礎架構 |
| 2.2 | 註冊與登入功能（API 路由） | 基本帳號系統 |
| 2.3 | JWT 登入驗證 + 會員區域保護 | 安全的登入機制（密鑰從環境變數讀取） |
| 2.4 | 電子郵件驗證（6位數驗證碼） | 註冊後自動發送，支援重新發送（60秒限流） |
| 2.5 | 雙重驗證（2FA TOTP） | Google Authenticator 相容，含10組備用碼 |
| 2.6 | 2FA 交易保護 | 下單、出金、改密碼皆需驗證碼 |
| 2.7 | KYC 等級 0→1（自動核准） | Email 驗證 + 手機驗證即通過 |
| 2.8 | KYC 等級 1→2（待審核） | 填寫個人資料 + 上傳身分證至 R2 |
| 2.9 | 手機號碼驗證（簡訊 OTP） | 支援台灣手機格式（09xxxxxxxx） |
| 2.10 | KYC 權限管控 | L2 才能交易、L1 才能出金 |
| 2.11 | LINE 登入整合（OAuth 2.1） | 綁定/解綁、LINE 快速登入、CSRF 保護 |
| 2.12 | 設定頁面全面更新 | 個人資料、Email 驗證、2FA、KYC 升級、LINE 連結 |
| 2.13 | 登入頁面更新 | 2FA 驗證步驟 + LINE 登入按鈕 |
| 2.14 | 共用工具 | KV 限流器、錯誤回應格式、資料庫映射器 |
| 2.15 | 雙語支援（繁中/英文） | 所有新功能皆有完整翻譯 |
| 2.16 | 會員專區基本架構 | 登入後的個人頁面 |
| 2.17 | Email 真實發送（Resend） | 驗證碼信件由 Resend API 寄出，取代開發用 stub |
| 2.18 | Google 登入整合（OAuth 2.0） | 登入與註冊頁均有 Google 按鈕；新用戶自動建立帳號（Email 已驗證）；既有帳號自動連結 |
| 2.19 | 後台管理系統框架 | `/admin` 路由群組，DB 角色驗證（role='admin'），IBM Plex Mono 終端機風格介面 |
| 2.20 | KYC L2 管理員審核介面 | 展開式申請卡片、狀態分頁（待審/已核准/已拒絕）、核准升級用戶 kyc_level、拒絕必填備注 |
| 2.21 | 用戶管理介面 | 可搜尋用戶清單（Email/姓名）、分頁、KYC 等級徽章、驗證狀態、凍結/解凍帳號 |

### 第三階段：交易核心 ✅ 已完成

| 步驟 | 內容 | 交付成果 |
|------|------|---------|
| 3.1 | 完整資料庫架構（8張交易表、15個種子掛牌） | 金融級資料儲存 |
| 3.2 | 掛牌產品 API + 會員專區架構（側欄導覽） | 產品目錄系統 + 儀表板 |
| 3.3 | 錢包功能（入金、出金、餘額、交易紀錄） | 資金管理（BigInt 精確計算） |
| 3.4 | 自選清單、投資組合、訂單管理、收入分成、設定頁 | 全部儀表板頁面可使用 |
| 3.5 | 撮合引擎（獨立 Worker + 每檔一個 Durable Object） | 價格時間優先撮合、部分成交、風控檢查 |
| 3.6 | WebSocket 即時推送（DO Hibernation API） | 即時掛單簿 + 成交推播、自動重連 |
| 3.7 | 交易介面（掛單簿、委託表單、價格圖表、成交紀錄） | 完整交易頁面（精密終端風格） |

### 安全強化（第二、三階段後）

| 修復項目 | 問題 | 解決方案 |
|---------|------|---------|
| 登入驗證流程 | 瀏覽器未正確傳送登入憑證至伺服器端渲染頁面 | 改用 httpOnly Cookie 機制，伺服器自動讀取 |
| LINE 2FA 繞過 | LINE 登入跳過雙重驗證，且令牌外洩於網址 | 新增 2FA 檢查；令牌改存於 Cookie，不再出現在網址 |
| 撮合引擎故障回滾 | 引擎異常時訂單卡住、資金鎖死 | 失敗時自動取消訂單、解鎖資金、寫入稽核紀錄 |
| 價格改善退還 | 買單以更優價格成交時，多鎖資金未退還 | 成交後計算實際成本，退還差額 |
| 錢包併發競態 | 同時出金/鎖倉可能超支 | 使用樂觀並發控制（條件式更新） |
| JWT 開發金鑰 | 正式環境可能誤用開發用金鑰 | 正式環境未設定金鑰時立即報錯 |

### 第四階段：收入分成 + 合規

| 步驟 | 內容 | 交付成果 |
|------|------|---------|
| 4.1 | 收入分成自動計算與發放 ✅ | 管理員輸入總收入金額 → 系統按持倉比例計算 → 批量入帳至所有投資人錢包，並寫入 audit_log |
| 4.2 | 交易通知系統 ✅ | KYC 審核結果、收入分成入帳、出金申請受理 — 三類 Email 通知（透過 Resend，永不阻塞主業務） |
| 4.3 | 首頁市場統計數據串接 ✅ | 累計交易量、活躍掛牌數、用戶數、今日分成金額 — 全部從 D1 即時讀取，取代靜態佔位符 |
| 4.4 | 儀表板最近活動串接 ✅ | 用戶最近 10 筆錢包交易，含類型（入金/出金/分成/買賣）、金額（入帳綠色/出帳紅色）、日期 |
| 4.5 | 稽核軌跡（不可竄改的紀錄） | 合規所需的交易紀錄 |
| 4.6 | 洗錢防制交易監控 | 可疑交易自動偵測 |
| 4.7 | 金管會格式報表 | 定期合規申報 |
| 4.8 | 金管會監理沙盒申請 | **啟動正式核准流程** |

### 技術選型摘要

| 項目 | 選擇 | 原因 |
|------|------|------|
| 網站 + API | SvelteKit（Cloudflare） | 同一套程式碼處理網站和後端，開發效率最高 |
| 資料庫 | Cloudflare D1 | 免維護、自動備份、亞太區部署 |
| 快取 / 登入 | Cloudflare KV | 全球低延遲，用於 JWT 登入驗證 |
| 檔案儲存 | Cloudflare R2 | KYC 文件、報表，S3 相容 |
| 交易引擎 | Cloudflare Durable Objects | 即時撮合、WebSocket 推送 |
| 安全防護 | Cloudflare WAF | 內建 DDoS 防護、OWASP 防護規則 |
| 金融資料合規 | 預留 GCP 台灣機房遷移路徑 | 若金管會要求資料在地化，可無縫遷移 |

> **成本優勢**：MVP 階段使用 Cloudflare 免費方案即可運作，無需支付伺服器費用。傳統架構（GCP 台灣機房 + Go + PostgreSQL + Redis）每月基礎成本約 USD $300-500，Cloudflare 方案在流量規模較小時幾乎為零。

---

## 十一、核心競爭優勢

1. **合規優先** — 從設計階段就考量金管會所有要求，不是事後補救
2. **現代化體驗** — 參考 Fugle、永豐金等台灣金融科技公司的使用者體驗
3. **LINE 深度整合** — 台灣用戶最熟悉的通訊工具，用於登入和通知
4. **中小企業友善** — 降低融資門檻，不需要稀釋股權
5. **投資人保護** — 分級 KYC、風險適合度評估、即時風險控管
6. **技術可靠** — 高效能撮合引擎（毫秒級延遲）、99.95% 正常運行時間

---

## 十二、設計文件索引

完整技術規格文件（英文）：

| 文件 | 內容 |
|------|------|
| `PORTAL_SPEC.md` | 公開網站規格 — 導覽、首頁、元件、多語系、效能 |
| `CORE_ENGINE.md` | 交易核心規格 — 撮合引擎、訂單管理、API、資料庫、基礎架構 |
| `AUTH_SPEC.md` | 身份驗證規格 — KYC、LINE 登入、2FA、會員專區 |
| `COMPLIANCE.md` | 法規遵循規格 — 金管會、資料在地化、稽核、洗錢防制 |
| `SPEC.md` | 原始參考規格 — MCEX 分析、設計系統 |

營運操作文件（中文）：

| 文件 | 內容 |
|------|------|
| `OPERATIONS.md` | **營運指引** — 管理員設定、KYC 審核、收入分成發放、入金出金人工流程、緊急操作、常用查詢指令 |

---

*文件最後更新：民國115年2月（第二階段完整版 + 第三階段完成 + 安全強化 + Google OAuth + Resend Email + 後台管理系統 + 收入分成引擎 + 通知系統 + 首頁與儀表板即時數據串接 + 營運指引）*
